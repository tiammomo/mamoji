{
  "version": "1.0",
  "skills": {
    "java": {
      "enabled": true,
      "version": "21",
      "frameworks": ["Spring Boot 3.5.3", "MyBatis-Plus 3.5.5", "Spring Security 6.5.1"],
      "description": "后端 Java 开发技能"
    },
    "typescript": {
      "enabled": true,
      "version": "20",
      "frameworks": ["Next.js 16", "React 19", "shadcn/ui", "Recharts", "TailwindCSS"],
      "description": "前端 TypeScript 开发技能"
    },
    "database": {
      "enabled": true,
      "types": ["MySQL 8.0", "Redis 7.x"],
      "description": "数据库开发与优化技能"
    },
    "docker": {
      "enabled": true,
      "version": "latest",
      "description": "容器化与 Docker Compose 技能"
    },
    "testing": {
      "enabled": true,
      "java": ["JUnit 5", "Mockito"],
      "typescript": ["Jest", "Testing Library"],
      "e2e": ["Playwright"],
      "description": "单元测试与集成测试技能"
    }
  },
  "maintenance": {
    "checklist": [
      "拉取最新代码 git pull",
      "检查 Docker 服务状态 docker-compose ps",
      "运行数据库迁移脚本 db/init/",
      "更新依赖 mvn/npm update",
      "运行后端测试 cd api && mvn test",
      "运行前端单元测试 cd web && npm test",
      "运行前端集成测试 cd web && npm run test:e2e",
      "代码格式化 mvn spotless:apply && npm run format",
      "更新 skills.json（如有技术栈变更）"
    ],
    "update_frequency": "每次开发前"
  },
  "project_info": {
    "name": "Mamoji 记账系统",
    "description": "个人记账财务管理应用",
    "tech_stack": {
      "backend": ["Java 21", "Spring Boot 3.5.3", "MyBatis-Plus 3.5.5", "MySQL", "Redis"],
      "frontend": ["TypeScript", "Next.js 16", "React 19", "shadcn/ui", "Recharts"],
      "devops": ["Docker", "Docker Compose"]
    },
    "ports": {
      "api": 48080,
      "web": 43000,
      "mysql": 3306,
      "redis": 6379
    },
    "environments": {
      "local": {
        "description": "本地开发环境（Docker 内组件）",
        "mysql": "localhost:3306 (Docker)",
        "redis": "localhost:6379 (Docker)",
        "profile": "dev",
        "credentials": {
          "mysql": { "username": "root", "password": "rootpassword" },
          "redis": { "password": "" },
          "test_users": [
            { "username": "admin", "password": "admin123", "role": "super_admin" },
            { "username": "testuser", "password": "test123", "role": "normal" }
          ]
        }
      },
      "production": {
        "description": "生产环境（云服务组件）",
        "mysql": "rm-bp14vg2ya3u8067d0ko.mysql.rds.aliyuncs.com:3306",
        "redis": "r-bp17r86g9eu9urg5wepd.redis.rds.aliyuncs.com:6379",
        "profile": "prod",
        "credentials": {
          "mysql": { "username": "mamoji", "password": "${DATABASE_PASSWORD}" },
          "redis": { "password": "${REDIS_PASSWORD}" }
        }
      }
    },
    "quick_start": {
      "docker": "docker-compose up -d mysql redis",
      "backend": "cd api && mvn spring-boot:run -Dspring-boot.run.profiles=dev",
      "frontend": "cd web && npm run dev -- --port 43000",
      "test_login": { "url": "http://localhost:43000/login", "username": "admin", "password": "admin123" }
    },
    "commands": {
      "format_backend": "cd api && mvn spotless:apply",
      "format_frontend": "cd web && npm run format",
      "lint_frontend": "cd web && npm run lint",
      "test_backend": "cd api && mvn test",
      "test_frontend": "cd web && npm test",
      "test_e2e": "cd web && npm run test:e2e"
    }
  },
  "api_docs": {
    "base_url": "http://localhost:48080/api/v1",
    "auth_type": "Bearer JWT",
    "auth_header": "Authorization",
    "endpoints": {
      "auth": {
        "login": "POST /auth/login",
        "register": "POST /auth/register",
        "logout": "POST /auth/logout",
        "profile": "GET /auth/profile"
      },
      "accounts": {
        "list": "GET /accounts",
        "get": "GET /accounts/{id}",
        "create": "POST /accounts",
        "update": "PUT /accounts/{id}",
        "delete": "DELETE /accounts/{id}",
        "flows": "GET /accounts/{id}/flows",
        "summary": "GET /accounts/summary"
      },
      "categories": {
        "list": "GET /categories?type=income|expense",
        "get": "GET /categories/{id}",
        "create": "POST /categories",
        "update": "PUT /categories/{id}",
        "delete": "DELETE /categories/{id}",
        "presets": {
          "income": ["工资", "奖金", "投资收入", "兼职收入", "礼金", "其他收入"],
          "expense": ["餐饮", "交通", "购物", "居住", "娱乐", "通讯", "医疗", "教育", "旅游", "人情", "理财", "其他支出"]
        }
      },
      "transactions": {
        "list": "GET /transactions?current=1&size=100",
        "get": "GET /transactions/{id}",
        "create": "POST /transactions",
        "update": "PUT /transactions/{id}",
        "delete": "DELETE /transactions/{id}",
        "recent": "GET /transactions/recent?limit=10",
        "refunds": "GET /transactions/{id}/refunds",
        "note": "支出交易必须关联 budgetId"
      },
      "budgets": {
        "list": "GET /budgets?activeOnly=true",
        "get": "GET /budgets/{id}",
        "create": "POST /budgets",
        "update": "PUT /budgets/{id}",
        "delete": "DELETE /budgets/{id}",
        "progress": "GET /budgets/{id}/progress"
      },
      "reports": {
        "summary": "GET /reports/summary?startDate=&endDate=",
        "income-expense": "GET /reports/income-expense",
        "monthly": "GET /reports/monthly?year=2026&month=1",
        "daily": "GET /reports/daily?startDate=&endDate=",
        "balance-sheet": "GET /reports/balance-sheet",
        "trend": "GET /reports/trend?startDate=&endDate=&period=daily|weekly|monthly"
      },
      "refunds": {
        "list": "GET /transactions/{id}/refunds",
        "create": "POST /transactions/{id}/refunds",
        "cancel": "DELETE /transactions/{id}/refunds/{refundId}"
      }
    }
  },
  "database_schema": {
    "init_script": "db/init/",
    "tables": {
      "fin_category": {
        "description": "分类表（收入/支出分类）",
        "columns": {
          "category_id": "BIGINT, 分类ID (主键)",
          "user_id": "BIGINT, 用户ID（0=系统预设）",
          "name": "VARCHAR(50), 分类名称",
          "type": "VARCHAR(20), 类型（income/expense）",
          "status": "TINYINT, 状态（1=启用）"
        }
      },
      "fin_account": {
        "description": "账户表",
        "columns": {
          "account_id": "BIGINT, 账户ID (主键)",
          "user_id": "BIGINT, 用户ID",
          "name": "VARCHAR(100), 账户名称",
          "type": "VARCHAR(20), 类型（cash/bank/credit/digital）",
          "balance": "DECIMAL(15,2), 余额",
          "status": "TINYINT, 状态"
        }
      },
      "fin_transaction": {
        "description": "交易记录表",
        "columns": {
          "transaction_id": "BIGINT, 交易ID (主键)",
          "user_id": "BIGINT, 用户ID",
          "account_id": "BIGINT, 账户ID",
          "category_id": "BIGINT, 分类ID",
          "budget_id": "BIGINT, 预算ID（支出必填）",
          "type": "VARCHAR(20), 类型（income/expense/refund）",
          "amount": "DECIMAL(15,2), 金额",
          "occurred_at": "DATETIME, 交易时间",
          "note": "VARCHAR(500), 备注",
          "refund_amount": "DECIMAL(15,2), 已退款金额"
        }
      },
      "fin_budget": {
        "description": "预算表",
        "columns": {
          "budget_id": "BIGINT, 预算ID (主键)",
          "user_id": "BIGINT, 用户ID",
          "name": "VARCHAR(100), 预算名称",
          "amount": "DECIMAL(15,2), 预算金额",
          "spent": "DECIMAL(15,2), 已支出金额",
          "start_date": "DATE, 开始日期",
          "end_date": "DATE, 结束日期",
          "status": "TINYINT, 状态"
        }
      },
      "fin_refund": {
        "description": "退款记录表",
        "columns": {
          "refund_id": "BIGINT, 退款ID (主键)",
          "transaction_id": "BIGINT, 原交易ID",
          "user_id": "BIGINT, 用户ID",
          "amount": "DECIMAL(15,2), 退款金额",
          "occurred_at": "DATETIME, 退款时间",
          "note": "VARCHAR(500), 备注"
        }
      },
      "sys_user": {
        "description": "用户表",
        "columns": {
          "user_id": "BIGINT, 用户ID (主键)",
          "username": "VARCHAR(50), 用户名（唯一）",
          "password": "VARCHAR(255), 密码（BCrypt加密）",
          "phone": "VARCHAR(20), 电话",
          "email": "VARCHAR(100), 邮箱",
          "role": "VARCHAR(20), 角色（super_admin/normal）",
          "status": "TINYINT, 状态（1=启用）"
        }
      }
    }
  },
  "code_style": {
    "editorconfig": true,
    "prettier": {
      "semi": false,
      "singleQuote": true,
      "tabWidth": 2,
      "trailingComma": "none",
      "printWidth": 100
    },
    "spotless": {
      "java_style": "AOSP",
      "import_order": ["java,javax,org,spring,com,net", "|"]
    },
    "rules": {
      "java": {
        "max_method_lines": 50,
        "max_class_lines": 500,
        "max_parameters": 4
      },
      "typescript": {
        "max_component_lines": 150,
        "hooks_order": ["useState", "useEffect", "useCallback", "useMemo", "useRef", "useContext", "custom"]
      }
    }
  },
  "common_issues": [
    {
      "id": "encoding",
      "title": "中文乱码问题",
      "symptoms": ["分类名称显示为 é¤é¥®", "数据库查询结果乱码"],
      "causes": [
        "JDBC URL 使用了不支持的编码值 characterEncoding=utf8mb4",
        "MySQL 客户端默认使用 latin1 编码连接"
      ],
      "solutions": [
        "修改 application-*.yml: characterEncoding=UTF-8",
        "修复数据: docker exec mysql mysql --default-character-set=utf8mb4 ...",
        "重启后端服务"
      ],
      "files": [
        "api/src/main/resources/application-dev.yml",
        "api/src/main/resources/application-test.yml",
        "api/src/main/resources/application-prod.yml"
      ]
    },
    {
      "id": "login-403",
      "title": "登录 403 错误",
      "symptoms": ["前端登录返回 403", "JWT Token 无效"],
      "causes": ["Token 过期", "CSRF 保护", "CORS 配置"],
      "solutions": ["检查 JWT_SECRET 配置", "验证 CORS 白域名"],
      "files": ["api/src/main/java/com/mamoji/config/SecurityConfig.java"]
    }
  ],
  "change_history": [
    {
      "date": "2026-01-30",
      "version": "1.4.0",
      "description": "中文乱码问题修复 + .claude 文档完善",
      "changes": [
        "修复 JDBC URL 编码配置（utf8mb4 -> UTF-8）",
        "修复数据库中损坏的中文数据",
        "合并 README.md 到 settings.json（每次会话自动读取）"
      ],
      "fixed_bugs": ["JDBC 字符编码错误", "数据库中文数据损坏"]
    },
    {
      "date": "2026-01-29",
      "version": "1.3.0",
      "description": "测试体系完善 + 代码规范统一",
      "changes": [
        "添加 Playwright 集成测试 (18个测试全部通过)",
        "修复前端类型与后端命名不一致问题",
        "清理 Java 文件重复的 import (32个文件)",
        "显式配置 MyBatis-Plus snake_case 映射",
        "前端测试修复：56个 Jest 测试全部通过"
      ],
      "added_skills": ["Playwright E2E 测试"],
      "fixed_bugs": ["命名规范统一"]
    },
    {
      "date": "2026-01-29",
      "version": "1.2.0",
      "commit": "1148659",
      "description": "完整记账系统功能上线",
      "changes": [
        "交易预算关联：支出必须关联预算",
        "自定义日期报表功能 /reports/daily",
        "报表按月/自定义模式切换",
        "数据库编码问题修复",
        "更新 docs 文档与代码同步"
      ],
      "added_skills": ["预算管理", "报表统计"],
      "fixed_bugs": ["Map.of BigDecimal 序列化", "JDBC 字符编码 utf8mb4"]
    }
  ]
}
