# Mamoji 记账系统 - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品愿景
Mamoji 是一款简洁易用的个人/家庭记账系统，帮助用户轻松管理个人财务，掌握收支情况，实现财务健康。

### 1.2 目标用户
- 个人用户：需要日常记账、预算管理
- 家庭用户：家庭财务共用管理
- 理财新手：学习记账、控制支出

### 1.3 产品定位
轻量级、零门槛、专注核心功能的个人记账工具。

---

## 2. 技术架构

### 2.1 技术栈

| 层级 | 技术选型 | 版本 |
|------|----------|------|
| 后端框架 | Spring Boot | 3.5.3 |
| 开发语言 | Java | 21 |
| ORM 框架 | MyBatis-Plus | 3.5.5 |
| 数据库 | MySQL | 8.0 |
| 缓存 | Redis + Redisson | 7.x |
| 前端框架 | Next.js | 16 |
| 开发语言 | TypeScript | 5.x |
| UI 组件库 | shadcn/ui | latest |
| 样式方案 | TailwindCSS | 3.x |
| 认证方式 | JWT (HS256) | - |

### 2.2 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                        用户浏览器                            │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    Next.js 前端 (43000)                      │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐               │
│  │ 仪表盘     │  │ 交易管理   │  │ 报表统计   │               │
│  └───────────┘  └───────────┘  └───────────┘               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│               Spring Boot 后端 (48080)                       │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐               │
│  │ 认证模块   │  │ 业务模块   │  │ 安全模块   │               │
│  └───────────┘  └───────────┘  └───────────┘               │
└─────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┴───────────────┐
              ▼                               ▼
┌─────────────────────────┐   ┌─────────────────────────┐
│     MySQL (3306)        │   │      Redis (6379)       │
│   mamoji / mamoji_test  │   │   会话缓存 / 分布式锁    │
└─────────────────────────┘   └─────────────────────────┘
```

---

## 3. 功能需求

### 3.1 功能清单

| 模块 | 功能点 | 优先级 | 状态 |
|------|--------|--------|------|
| **用户系统** | 用户注册 | P0 | ✅ |
| | 用户登录 | P0 | ✅ |
| | Token 刷新 | P1 | ✅ |
| | 个人信息管理 | P2 | ○ |
| **账户管理** | 账户列表 | P0 | ✅ |
| | 添加账户 | P0 | ✅ |
| | 编辑账户 | P0 | ✅ |
| | 删除账户 | P1 | ✅ |
| | 账户汇总 | P1 | ✅ |
| **交易记录** | 记收入 | P0 | ✅ |
| | 记支出 | P0 | ✅ |
| | 交易列表 | P0 | ✅ |
| | 交易筛选 | P1 | ✅ |
| | 退款功能 | P1 | ✅ |
| **分类管理** | 系统预置分类 | P0 | ✅ |
| | 自定义分类 | P1 | ✅ |
| **预算管理** | 创建预算 | P0 | ✅ |
| | 预算列表 | P0 | ✅ |
| | 进度追踪 | P0 | ✅ |
| | 超支提醒 | P1 | ✅ |
| **报表统计** | 收支概览 | P0 | ✅ |
| | 分类报表 | P0 | ✅ |
| | 月度报表 | P0 | ✅ |
| | 趋势分析 | P1 | ✅ |
| | 资产负债表 | P1 | ✅ |

### 3.2 用户系统

#### 3.2.1 注册
- 支持邮箱注册
- 密码要求：至少6位
- 注册成功后自动登录

#### 3.2.2 登录
- 邮箱 + 密码登录
- JWT Token 认证（24小时有效）
- Token 自动刷新机制

#### 3.2.3 登出
- 清除本地 Token
- 服务端 Token 失效

---

### 3.3 账户管理

#### 3.3.1 账户类型

| 类型 | account_type | 计入净资产 | 说明 |
|------|--------------|------------|------|
| 银行卡 | bank | ✅ | 储蓄卡、借记卡 |
| 信用卡 | credit | ❌ | 信用卡（显示为负数） |
| 数字钱包 | digital | ✅ | 支付宝、微信等 |
| 现金 | cash | ✅ | 现金余额 |
| 投资 | investment | ✅ | 股票、基金 |
| 负债 | debt | ❌ | 贷款、借款 |

#### 3.3.2 账户属性
- 账户名称（必填）
- 账户类型（必填）
- 子类型（可选）
- 初始余额（必填）
- 是否计入净资产（可选，默认true）

#### 3.3.3 账户操作
- **创建**：添加新账户
- **编辑**：修改账户信息
- **删除**：软删除（status=0）
- **汇总**：计算所有账户的资产和负债

---

### 3.4 交易记录

#### 3.4.1 交易类型
| 类型 | 说明 |
|------|------|
| income | 收入 |
| expense | 支出 |

#### 3.4.2 交易属性
- 交易类型（必填）
- 金额（必填，正数）
- 账户ID（必填）
- 分类ID（必填）
- 预算ID（支出必填）
- 交易时间（必填）
- 备注（可选）

#### 3.4.3 退款功能
- 支出交易支持退款
- 退款金额不能超过原交易金额
- 支持部分退款
- 退款金额从已花费预算中扣除

#### 3.4.4 交易筛选
- 按账户筛选
- 按分类筛选
- 按类型筛选（收入/支出）
- 按日期范围筛选
- 按金额范围筛选
- 关键词搜索备注

---

### 3.5 分类管理

#### 3.5.1 系统预置分类

**收入分类**

| 分类名称 | 英文标识 | 图标 |
|----------|----------|------|
| 工资 | salary | 💰 |
| 奖金 | bonus | 🎁 |
| 投资 | investment | 📈 |
| 其他收入 | other_income | 💵 |

**支出分类**

| 分类名称 | 英文标识 | 图标 |
|----------|----------|------|
| 餐饮 | food | 🍔 |
| 交通 | transport | 🚗 |
| 购物 | shopping | 🛍️ |
| 娱乐 | entertainment | 🎬 |
| 居住 | housing | 🏠 |
| 生活 | living | 🛒 |
| 医疗 | medical | 💊 |
| 教育 | education | 📚 |
| 人情 | social | 🎊 |
| 其他支出 | other_expense | 💳 |

#### 3.5.2 分类属性
- 分类名称（必填）
- 分类类型（income/expense）
- 图标（可选）
- 状态（启用/禁用）

---

### 3.6 预算管理

#### 3.6.1 预算属性
- 预算名称（必填）
- 预算金额（必填）
- 开始日期（必填）
- 结束日期（必填）
- 预警阈值（可选，默认80%）
- 状态（自动计算）

#### 3.6.2 预算状态

| 状态 | 值 | 触发条件 |
|------|-----|----------|
| 进行中 | 1 | 当前日期在预算期间内 |
| 已完成 | 2 | 预算期间结束且未超支 |
| 超支 | 3 | 已花费 > 预算金额 |
| 已取消 | 0 | 手动取消 |

#### 3.6.3 预算进度计算
```
已花费 = 关联交易的金额总和
使用率 = 已花费 / 预算金额 * 100%
```

#### 3.6.4 状态自动更新
- 定时任务每日检查预算状态
- 交易创建/退款时自动更新关联预算的已花费金额

---

### 3.7 报表统计

#### 3.7.1 报表类型

**收支概览**
- 收入合计
- 支出合计
- 净收入
- 交易数量

**分类报表**
- 收入分布（饼图）
- 支出分布（饼图）
- 各类别金额明细

**月度报表**
- 按日汇总的收支数据
- 趋势折线图

**趋势报表**
- 支持日/周/月粒度
- 环比数据对比

**资产负债表**
- 资产合计
- 负债合计
- 净资产
- 各账户明细

#### 3.7.2 报表筛选
- **按月**：选择特定月份，默认显示上一个月
- **自定义**：选择日期范围

#### 3.7.3 月份选择
- 下拉框选择最近6个月
- 避免选项过多

---

## 4. 非功能需求

### 4.1 性能需求
- 页面加载时间 < 3秒
- API 响应时间 < 500ms
- 支持并发用户数 > 100

### 4.2 安全需求
- 密码加密存储（BCrypt）
- Token 时效性（24小时）
- SQL 注入防护
- XSS 攻击防护
- CORS 跨域控制

### 4.3 兼容性
- Chrome 最新版
- Firefox 最新版
- Safari 最新版
- Edge 最新版
- 移动端响应式适配

### 4.4 可用性
- 操作流程简洁
- 界面清晰直观
- 错误提示友好

---

## 5. 验收标准

### 5.1 功能验收
1. ✅ 用户可完成注册、登录、登出流程
2. ✅ 可正常添加、编辑、删除账户
3. ✅ 可正常记录收入和支出
4. ✅ 分类功能正常使用
5. ✅ 预算创建和进度追踪正常
6. ✅ 报表数据准确
7. ✅ 退款功能正常

### 5.2 性能验收
1. ✅ 首页加载时间 < 3秒
2. ✅ API 响应时间 < 500ms
3. ✅ 无明显页面卡顿

### 5.3 兼容性验收
1. ✅ Chrome 浏览器正常使用
2. ✅ 响应式布局正常显示
3. ✅ 移动端适配正常

---

## 6. 项目里程碑

| 阶段 | 内容 | 状态 |
|------|------|------|
| M1 | 基础架构搭建、用户系统 | ✅ |
| M2 | 账户管理、交易记录 | ✅ |
| M3 | 分类管理、预算管理 | ✅ |
| M4 | 报表统计、数据可视化 | ✅ |
| M5 | 测试优化、上线部署 | ○ |

---

## 7. 附录

### 7.1 术语表

| 术语 | 说明 |
|------|------|
| 净资产 | 资产 - 负债 |
| 净收入 | 收入 - 支出 |
| 预算使用率 | 已花费 / 预算金额 * 100% |
| 环比 | 与上一周期对比 |

### 7.2 参考产品
- 随手记
- 挖财记账
- 薄荷记账

---

**文档版本**: v1.0
**最后更新**: 2026-02-02
**负责人**: Mamoji Team
