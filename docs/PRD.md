# 企业级财务记账系统 PRD 文档

## 一、产品概述

### 1.1 产品定位
一款专为企业/工作室设计的财务记账管理系统，支持多端使用（Web + H5/移动端），实现多主体财务核算、协同管理和预算控制。

### 1.2 产品架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                         企业 (Enterprise)                            │
│  ├── 企业信息、营业执照、税务信息                                     │
│  ├── 成员管理                                                        │
│  ├── 人员-单元权限矩阵 (不同人员配置不同单元的权限)                    │
│  └── 多个记账单元 (支持父子层级结构)                                  │
│      ├── 记账单元 A（纯业务/家庭支出）- 无子单元                       │
│      │   ├── 收支记录                                                │
│      │   ├── 预算管理                                                │
│      │   └── 报表统计                                                │
│      ├── 记账单元 B（国内电商项目）                                   │
│      │   ├── 子单元 B1（抖音小店）                                   │
│      │   ├── 子单元 B2（淘宝店铺）                                   │
│      │   ├── 子单元 B3（1688批发）                                   │
│      │   └── 子单元 B4（小红书电商）                                 │
│      ├── 记账单元 C（跨境电商项目）                                   │
│      │   ├── 子单元 C1（亚马逊）                                     │
│      │   └── 子单元 C2（速卖通）                                     │
│      ├── 记账单元 D（公司资产）                                       │
│      │   ├── 子单元 D1（固定资产）                                   │
│      │   │   ├── 办公设备                                            │
│      │   │   ├── 交通工具                                            │
│      │   │   └── 厂房仓库                                            │
│      │   ├── 子单元 D2（无形资产）                                   │
│      │   │   ├── 商标专利                                            │
│      │   │   └── 软件版权                                            │
│      │   └── 子单元 D3（长期投资）                                   │
│      └── 记账单元 E（投资项目）                                       │
│          ├── 子单元 E1（股票投资）                                   │
│          ├── 子单元 E2（基金投资）                                   │
│          └── 子单元 E3（黄金/其他）                                  │
└─────────────────────────────────────────────────────────────────────┘
```

**记账单元类型说明：**
| 类型 | 说明 | 是否支持子单元 |
|------|------|----------------|
| 纯业务单元 | 日常经营收支、家庭支出等基础业务 | 否 |
| 国内电商 | 抖音、淘宝、1688、小红书等平台 | 是 |
| 跨境电商 | 亚马逊、速卖通等海外平台 | 是 |
| **公司资产** | 固定资产、无形资产、长期投资等资产类管理 | 是 |
| 投资项目 | 股票、基金、黄金等理财投资 | 是 |

### 1.3 目标用户
- 中小微企业/工作室
- 创业者/自由职业者
- 有多个业务线的团队
- 个人工作室或副业团队

### 1.4 核心价值
- **多主体核算**：支持企业下多个独立记账单元
- **业财一体化**：电商、副业、投资统一纳入公司经营核算
- **预算控制**：预算设置、审批流程、超支预警
- **资产管理**：多账户、多币种、资产归属管理
- **智能提醒**：投资更新提醒、定期到期提醒、预算预警

---

## 二、功能需求

### 2.1 核心功能模块

#### 2.1.1 企业与用户管理模块

| 功能项 | 说明 |
|--------|------|
| 企业注册 | 创建企业信息（名称、营业执照、税务信息） |
| 成员管理 | 添加/移除企业成员，设置角色权限 |
| 角色权限 | 超级管理员、财务管理员、普通成员、只读成员 |
| **人员-单元权限** | 不同人员可配置不同记账单元的访问权限 |
| 记账单元 | 企业下可创建多个记账单元，支持父子层级结构 |
| 个人设置 | 修改密码、头像、昵称 |

**企业级角色权限说明：**
- **超级管理员**：企业所有权限，包括成员管理、计费单元管理
- **财务管理员**：财务数据的增删改查，可审批预算
- **普通成员**：可记账、查看数据，不可删除他人记录
- **只读成员**：仅可查看数据

**人员-单元权限矩阵说明：**
除企业级角色外，系统支持按记账单元维度进行精细化权限控制：

| 人员 | 纯业务单元 | 国内电商单元 | 跨境电商单元 | 投资项目单元 |
|------|-----------|-------------|-------------|-------------|
| 财务A | 管理(全部) | - | - | - |
| 运营B | 查看 | 管理(抖音/小红书) | 查看 | - |
| 财务C | - | - | 管理(全部) | 查看 |
| 投资顾问D | - | - | - | 管理(股票/基金) |

**权限继承规则：**
1. 上级单元的权限可继承到下级子单元
2. 子单元可独立设置权限覆盖上级继承
3. 权限检查时向上查找最近的有效权限设置
4. 无任何权限设置时，继承企业级角色权限

#### 2.1.2 账户管理模块

| 功能项 | 说明 |
|--------|------|
| 账户类型 | 微信钱包、支付宝、银行卡（储蓄卡/信用卡）、现金、其他账户 |
| **账户归属** | 标记账户归属单元（各记账单元独立管理） |
| **银行卡类型** | 区分储蓄卡（一类卡/二类卡）和信用卡 |
| 账户操作 | 新增、编辑、删除、停用账户 |
| 账户余额 | 记录每个账户的当前余额/可用额度 |
| 账户流水 | 每个账户的资金变动记录 |

**储蓄卡类型说明：**
- 一类卡：全功能账户，无限额限制
- 二类卡：理财账户，有转账限额（通常日限额1万）

**信用卡类型说明：**
| 信用卡属性 | 说明 |
|------------|------|
| 卡片等级 | 普卡/金卡/白金卡/黑卡/钻石卡等 |
| 发卡银行 | 信用卡所属银行 |
| 账单日 | 每月账单生成日期（如：5号、10号、25号） |
| 还款日 | 每月还款截止日期（如：25号、30号） |
| 信用额度 | 信用卡最高可消费金额 |
| 可用额度 | 当前剩余可消费额度 |
| 预借现金额度 | 现金分期额度 |
| 本期已出账单 | 本月已消费待还款金额 |
| 本期未出账单 | 本月消费未入账金额 |
| 最低还款额 | 每月最低需还款金额 |

#### 2.1.3 收支记录模块

| 功能项 | 说明 |
|--------|------|
| **收入类型** | 主营业务收入、副业收入、电商销售收入、投资收益、其他收入 |
| **支出类型** | 经营成本、进货成本、平台抽佣、投流费用、合作分成、人员薪酬、办公费用、其他支出 |
| 记账方式 | 手动记账、导入账单 |
| 多账户关联 | 一笔收支可关联多个账户 |
| 标签分类 | 自定义标签，支持多标签 |
| 图片上传 | 支持上传凭证图片 |
| 备注 | 支持文字备注 |

**经营收支说明：**
- **主营业务收入**：公司核心业务的销售收入
- **副业收入**：除主业外的其他业务收入
- **进货成本**：商品采购成本
- **平台抽佣**：电商平台技术服务费、佣金
- **投流费用**：广告投放、推广费用（含ROI分析）
- **合作分成**：与合作伙伴的分成支出
- **人员薪酬**：员工工资、奖金等

#### 2.1.4 预算管理模块

| 功能项 | 说明 |
|--------|------|
| 预算类型 | 月度预算、年度预算、项目预算 |
| 预算单元 | 可按记账单元设置独立预算 |
| 预算分类 | 按支出分类设置预算 |
| 预算金额 | 设置总预算金额 |
| 预算周期 | 月度、季度、年度 |
| 预算状态 | 草稿、生效中、已超支、已结束 |
| 预算执行 | 显示已用金额、剩余金额、使用百分比 |

**预算审批流程：**
```
1. 成员创建预算申请（填写预算金额、用途、周期）
2. 提交审批
3. 管理员收到审批通知
4. 管理员审批（通过/拒绝/修改金额后通过）
5. 审批结果通知申请人
6. 预算生效
```

#### 2.1.5 理财收益专栏

| 功能项 | 说明 |
|--------|------|
| 理财账户 | 记录各理财产品（股票、基金、黄金、定期等） |
| 产品类型 | 股票（A股/港股/美股）、基金（偏股/偏债/货币）、黄金、白银、债券、定期存款、其他 |
| 本金记录 | 记录投入本金金额和日期 |
| 持仓信息 | 持仓数量、成本价、当前价 |
| 市值更新 | 手动更新当前市值，记录更新时间 |
| 收益记录 | 记录分红、利息、卖出盈亏等 |
| 收益率计算 | 自动计算持有收益率、年化收益率 |
| 收益图表 | 收益趋势可视化图表（K线图、净值曲线） |
| 资产分布 | 各理财产品的资产占比饼图 |
| **数据更新提醒** | 长时间未更新市值时自动提醒 |

**动态投资收益管理：**
- 支持多种投资产品类型，每种类型有专属字段
- 股票：股票代码、持仓数量、成本价、当前价、盈亏比例
- 基金：基金代码、持有份额、净值、累计收益
- 黄金：重量（克）、成本价、当前价、盈亏
- 定期：本金、利率、起息日、到期日、到期收益
- 每次更新市值时自动记录更新时间
- 系统检测超过设定天数未更新时发送提醒通知

**更新提醒规则：**
```
1. 股票类账户：默认 3 天未更新提醒
2. 基金类账户：默认 7 天未更新提醒
3. 黄金白银类：默认 7 天未更新提醒
4. 定期存款类：到期前 7 天提醒
5. 用户可自定义每个账户的提醒周期
6. 提醒频率：每天检查一次，发送一次提醒
```

#### 2.1.6 报表统计模块

| 功能项 | 说明 |
|--------|------|
| 收支总览 | 本月/本年收入、支出、结余 |
| 分类统计 | 各分类的收支占比 |
| 趋势分析 | 月度收支趋势折线图 |
| 账户统计 | 各账户余额分布 |
| 电商专项 | 进货成本、广告费、销售收入统计 |
| **投资专项** | 投资收益统计、持仓分布、收益率排行 |
| 导出功能 | 支持 Excel、PDF 导出 |

#### 2.1.7 消息通知模块

| 功能项 | 说明 |
|--------|------|
| 预算审批通知 | 新预算申请、审批结果 |
| 预算预警通知 | 预算使用达到 80%、90%、100% |
| 超支通知 | 预算已超支 |
| 大额支出提醒 | 单笔支出超过设定金额 |
| **投资更新提醒** | 投资账户长时间未更新市值提醒 |
| **定期到期提醒** | 定期存款到期前提醒 |
| 理财收益提醒 | 收益记录提醒 |
| **每日资产报告** | 每日推送企业整体资产情况 |

**每日资产报告推送：**
- 推送方式：邮件、微信
- 推送时间：用户自定义（默认每天晚上 8 点）
- 推送内容：
  - 企业总资产概览
  - 各记账单元经营情况
  - 各账户余额分布
  - 投资账户收益情况
  - 本月收支汇总
  - 预算执行状态
  - **逾期未更新项列表**（催促更新）

**报告内容模板：**
```
【每日经营报告】2024年1月15日

📊 资产概览
  企业总资产：¥XXX,XXX.XX
  本月收入：+¥X,XXX
  本月支出：-¥X,XXX
  本月结余：¥X,XXX

💰 记账单元经营情况
  主业务：收入 ¥X,XXX / 支出 ¥X,XXX
  电商项目：收入 ¥X,XXX / 支出 ¥X,XXX
  投资项目：收益 ¥X,XXX

💰 账户分布
  微信钱包：¥X,XXX
  支付宝：¥X,XXX
  工商银行(1234)：¥X,XXX
  ...

📈 投资收益
  股票账户：¥XX,XXX (收益率 +X.XX%)
  基金账户：¥XX,XXX (收益率 +X.XX%)
  黄金投资：¥X,XXX (收益率 +X.XX%)
  总收益：¥X,XXX (总收益率 +X.XX%)

📊 预算状态
  生活支出：80% (已用 ¥4,000 / 预算 ¥5,000)
  进货成本：40% (已用 ¥2,000 / 预算 ¥5,000)

⚠️ 待更新项
  • 贵州茅台 - 已5天未更新市值
  • 易方达蓝筹 - 已8天未更新市值
  • 上海黄金 - 已10天未更新市值

请及时更新投资账户市值，以便准确掌握资产情况。
```

---

## 三、界面设计要点

### 3.1 首页布局
```
+------------------------------------------+
|  企业记账                       头像 通知 |
+------------------------------------------+
|  企业总资产: ¥XXX,XXX.XX                 |
|  本月收入: +¥X,XXX  本月支出: -¥X,XXX    |
|  当前单元: [下拉选择记账单元]             |
+------------------------------------------+
|  [快速记账]                              |
+------------------------------------------+
|  预算状态                                |
|  ┌─────────────────────────────────┐    |
|  | 生活支出  ████████░░  80%        |    |
|  | 进货预算  █████░░░░░  40%        |    |
|  | 广告费用  ██████████  100%(预警) |    |
|  └─────────────────────────────────┘    |
+------------------------------------------+
|  理财收益专栏                            |
|  ┌─────────────────────────────────┐    |
|  | 本月收益 +¥XXX   +X.XX%          |    |
|  | [收益趋势图]                     |    |
|  └─────────────────────────────────┘    |
+------------------------------------------+
|  最近账单                                |
|  • 今天  支出 -¥88  生活用品-微信        |
|  • 昨天  收入 +¥500  电商收入-支付宝     |
+------------------------------------------+
```

### 3.2 多端适配
- **Web 端**：完整功能，支持复杂报表展示
- **移动端**：精简界面，快速记账为核心
- **响应式设计**：自动适配不同屏幕尺寸

---

## 四、技术架构

### 4.1 技术栈

| 层级 | 技术选型 |
|------|----------|
| 前端框架 | Next.js 14+ (App Router) |
| 前端语言 | TypeScript |
| UI 组件库 | shadcn/ui / Ant Design Mobile |
| 状态管理 | Zustand / React Context |
| 图表库 | ECharts / Recharts |
| 后端框架 | Hertz (CloudWeGo) |
| 后端语言 | Go 1.21+ |
| 数据库 | MySQL 8.0+ |
| 缓存 | Redis |
| 部署方式 | Docker + Docker Compose |

### 4.2 架构设计

```
┌─────────────────────────────────────────────────────┐
│                   客户端层                           │
│  ┌──────────────┐         ┌──────────────┐          │
│  │  Web 前端    │         │  移动端 H5   │          │
│  │  (Next.js)   │         │  (Next.js)   │          │
│  └──────────────┘         └──────────────┘          │
└─────────────────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────┐
│                   网关层                             │
│              (Nginx / Traefik)                      │
└─────────────────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────┐
│                   应用层                             │
│  ┌──────────────────────────────────────────────┐   │
│  │           Hertz HTTP 服务                    │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐        │   │
│  │  │用户服务 │ │账单服务 │ │预算服务 │        │   │
│  │  └─────────┘ └─────────┘ └─────────┘        │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐        │   │
│  │  │账户服务 │ │理财服务 │ │报表服务 │        │   │
│  │  └─────────┘ └─────────┘ └─────────┘        │   │
│  └──────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────┐
│                   数据层                             │
│  ┌──────────────┐         ┌──────────────┐          │
│  │    MySQL     │         │    Redis     │          │
│  └──────────────┘         └──────────────┘          │
└─────────────────────────────────────────────────────┘
```

### 4.3 部署架构

```
┌─────────────────────────────────────────────────────┐
│                   Docker Compose                     │
│  ┌──────────────┐                                   │
│  │   Nginx      │  (反向代理 + SSL)                 │
│  │   :443       │                                   │
│  └──────────────┘                                   │
│         │                                           │
│         ├─────────────┬─────────────┐               │
│         ▼             ▼             ▼               │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐│
│  │  Next.js     │ │   Hertz      │ │   MySQL      ││
│  │  :3000       │ │   :8888      │ │   :3306      ││
│  └──────────────┘ └──────────────┘ └──────────────┘│
│  ┌──────────────┐                                  ││
│  │   Redis      │                                  ││
│  │   :6379      │                                  ││
│  └──────────────┘                                  ││
└─────────────────────────────────────────────────────┘
```

---

## 五、数据模型设计

### 5.1 核心实体

```
用户 (User)
├── ID
├── 用户名
├── 密码
├── 手机号
├── 邮箱
├── 头像
└── 创建时间

企业 (Enterprise)
├── ID
├── 企业名称
├── 统一社会信用代码
├── 联系人
├── 联系电话
├── 企业地址
├── 营业执照图片
├── 状态 (正常/停用)
└── 创建时间

企业成员 (EnterpriseMember)
├── ID
├── 企业ID
├── 用户ID
├── 角色 (超级管理员/财务管理员/普通成员/只读成员)
└── 加入时间

记账单元 (AccountingUnit)
├── ID
├── 企业ID
├── 父单元ID (支持多级子单元，顶级单元为 NULL)
├── 单元名称 (如：主业务/抖音小店/亚马逊/办公设备)
├── 单元类型 (纯业务/国内电商/跨境电商/公司资产/投资项目)
├── 单元层级 (1=一级单元, 2=二级子单元, ...)
├── 状态 (正常/停用)
└── 创建时间

单元权限 (UnitPermission)
├── ID
├── 企业ID
├── 用户ID
├── 记账单元ID (支持设置到任意层级单元)
├── 权限级别 (查看/编辑/管理)
│   ├── 查看：仅可查看该单元及子单元数据
│   ├── 编辑：可进行记账、修改操作
│   └── 管理：可管理该单元及子单元的账户、预算等
└── 创建时间

账户 (Account)
├── ID
├── 企业ID
├── 记账单元ID
├── 账户类型 (微信/支付宝/储蓄卡/信用卡/现金)
├── 账户名称
├── 账户号 (卡号后四位)
├── **卡片类型** (储蓄卡：一类卡/二类卡；信用卡：默认)
├── **储蓄卡属性**
│   └── 当前余额
├── **信用卡属性**
│   ├── 卡片等级 (普卡/金卡/白金卡/黑卡/钻石卡)
│   ├── 发卡银行
│   ├── 账单日 (1-28号)
│   ├── 还款日 (1-28号)
│   ├── 信用额度
│   ├── 可用额度
│   ├── 预借现金额度
│   ├── 本期已出账单
│   ├── 本期未出账单
│   └── 最低还款额
├── 状态
└── 创建时间

账单 (Transaction)
├── ID
├── 企业ID
├── 记账单元ID
├── 用户ID
├── 类型 (收入/支出)
├── 分类 (主营业务收入/副业收入/进货成本/平台抽佣/投流费用/合作分成等)
├── 金额
├── 账户ID
├── 发生时间
├── 标签
├── 备注
├── 图片
├── 经营信息 (JSON: 供应商/商品类目/平台抽佣/投流费用/合作分成等)
└── 创建时间

预算 (Budget)
├── ID
├── 企业ID
├── 记账单元ID
├── 预算名称
├── 预算类型 (月度/项目)
├── 分类
├── 总金额
├── 已用金额
├── 周期开始
├── 周期结束
├── 状态 (草稿/生效/超支/结束)
└── 创建时间

预算审批 (BudgetApproval)
├── ID
├── 预算ID
├── 申请人ID
├── 审批人ID
├── 申请金额
├── 审批金额
├── 状态 (待审批/已通过/已拒绝)
├── 申请原因
├── 审批意见
├── 申请时间
└── 审批时间

理财账户 (InvestmentAccount)
├── ID
├── 企业ID
├── 记账单元ID
├── 账户名称
├── 产品类型 (股票/基金/黄金/债券/定期等)
├── 产品代码 (股票代码/基金代码等)
├── 本金
├── 当前市值
├── 总收益
├── 持仓数量/份额
├── 成本价
├── 当前价
├── 最后更新时间
├── 提醒周期 (天数)
├── 状态
└── 创建时间

理财记录 (InvestmentRecord)
├── ID
├── 理财账户ID
├── 类型 (买入/卖出/收益更新/分红/利息)
├── 金额
├── 记录时间
├── 单价/净值
├── 数量/份额
└── 备注

通知 (Notification)
├── ID
├── 用户ID
├── 类型
├── 标题
├── 内容
├── 是否已读
└── 创建时间

推送配置 (PushConfig)
├── ID
├── 家庭ID
├── 推送类型 (email/wechat)
├── 推送目标 (邮箱地址/微信号)
├── 推送开关
├── 推送时间 (HH:mm)
├── 推送频率
└── 创建时间

推送记录 (PushLog)
├── ID
├── 家庭ID
├── 推送类型
├── 推送内容
├── 推送状态 (success/failed)
├── 失败原因
├── 推送时间
└── 创建时间
```

---

## 六、非功能需求

### 6.1 性能要求
- API 响应时间 < 500ms (P95)
- 页面首次加载 < 2s
- 支持 100+ 并发用户

### 6.2 安全要求
- 密码加密存储 (bcrypt)
- JWT Token 认证
- HTTPS 传输加密
- 接口防刷限流

### 6.3 兼容性要求
- 浏览器：Chrome 90+、Safari 14+、Edge 90+
- 移动端：iOS 14+、Android 10+

### 6.4 可用性要求
- 系统可用性 > 99.5%
- 数据每日自动备份

---

## 七、项目里程碑

### Phase 1: 基础功能 (4周)
- [ ] 用户注册登录
- [ ] 家庭绑定
- [ ] 账户管理
- [ ] 基础收支记账

### Phase 2: 核心功能 (4周)
- [ ] 预算管理
- [ ] 预算审批流程
- [ ] 预算预警通知

### Phase 3: 特色功能 (3周)
- [ ] 理财收益专栏
- [ ] 电商专项字段
- [ ] 收支报表统计

### Phase 4: 优化上线 (2周)
- [ ] 性能优化
- [ ] 移动端适配优化
- [ ] 部署上线

---

## 八、后续扩展方向

1. **账单导入**：支持支付宝/微信账单自动导入
2. **AI 分类**：使用 AI 自动识别账单分类
3. **多币种**：支持外币账户和汇率换算
4. **数据导出**：支持更多格式导出
5. **分享功能**：生成报表分享给家人
6. **定期提醒**：定期记账提醒、账单日提醒
